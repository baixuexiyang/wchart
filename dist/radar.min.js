function getRealRatio(){if(1===flag){++flag;var t=CanvasRenderingContext2D.prototype,e=function(){var t=document.createElement("canvas"),e=t.getContext("2d"),o=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/o}(),o=function(t,e){for(var o in t)t.hasOwnProperty(o)&&e(t[o],o)},n={fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"};1!==e&&(o(n,function(o,n){t[n]=function(t){return function(){var n,r,i=Array.prototype.slice.call(arguments);if("all"===o)i=i.map(function(t){return t*e});else if(Array.isArray(o))for(n=0,r=o.length;n<r;n++)i[o[n]]*=e;return t.apply(this,i)}}(t[n])}),t.ratio=e,t.stroke=function(t){return function(){this.lineWidth*=e,t.apply(this,arguments),this.lineWidth/=e}}(t.stroke),t.fillText=function(t){return function(){var o=Array.prototype.slice.call(arguments);o[1]*=e,o[2]*=e,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,o,n){return o*e+n}),t.apply(this,o),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,o,n){return o/e+n})}}(t.fillText),t.strokeText=function(t){return function(){var o=Array.prototype.slice.call(arguments);o[1]*=e,o[2]*=e,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,o,n){return o*e+n}),t.apply(this,o),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,o,n){return o/e+n})}}(t.strokeText))}}function extend(t,e){for(var o in e)t.hasOwnProperty(o)&&"object"==typeof t[o]?extend(t[o],e[o]):t[o]=e[o];return t}function calcLocation(t,e,o){return{x:t[0]+e*Math.cos(Math.PI*o),y:t[1]+e*Math.sin(Math.PI*o)}}var flag=1;!function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e():"function"==typeof define&&define.amd?define(e):this[t]=e()}("Radar",function(){function t(t){getRealRatio();var f={styles:{offset:{top:8,left:0},border:{width:2,color:"#deebff"},splitLine:{color:"#dbeaff"},title:{font:"bold 52px Microsoft YaHei",color:"#F56948"},valueRange:{border:{width:2,color:"#c2dbff"},background:"rgba(194, 219, 255, 0.5)",arrow:2},inner:{radius:70,background:"#fff"},label:{image:"",font:"16px Microsoft YaHei",color:"#666"}}};this.options=extend(f,t),this.dataLoc=[],o=this.options.styles,n=o.border,r=o.splitLine,i=o.title,a=o.valueRange,l=o.inner,c=o.label,e="string"==typeof this.options.element?document.getElementById(this.options.element):this.options.element,context=e.getContext("2d");var s=this;e.addEventListener("click",function(t){var e,o;t.x||0==t.y?(e=t.x,o=t.y):t.layerX||0==t.layerX?(e=t.layerX,o=t.layerY):(t.offsetX||0==t.offsetX)&&(e=t.offsetX,o=t.offsetY);for(var n=0,r=s.dataLoc.length;n<r;n++){var i=s.dataLoc[n];if(i.x<e&&e<i.x+i.w&&i.y<o&&o<i.y+i.h)return void s.options.polar[n].clickHandler()}})}var e,o,n,r,i,a,l,c;return t.prototype.draw=function(){var t=e.offsetWidth,o=e.offsetHeight,n=this.options.styles.offset;this.drawing([t/2+n.left,o/2+n.top],t,o)},t.prototype.drawing=function(t,e,o){var n=this,r=this.options.polar,i=r.length,a=this.options.radius,c=this.options.data;angles=[],borderLoc=[];for(var f=[],s=0;s<i;s++){f.push(0);var d=1.5+s*(2/i);angles.push(d),borderLoc.push(calcLocation(t,a,d))}context.fillStyle="#fff",context.fillRect(0,0,e,o),this.drawIcon(borderLoc,r);var x=this.calcRedrawPath(borderLoc),h=setInterval(function(){for(var e=0,o=0,s=[],d=[],p=0;p<i;p++){f[p]=f[p]+5>c[p]?c[p]:f[p]+5,f[p]===c[p]&&++e;var u=angles[p];l.radius;d.push(calcLocation(t,l.radius,u));var y=f[p]/r[p].max*a;s.push(calcLocation(t,y,u)),o+=f[p]}e===i&&clearInterval(h),context.clearRect(x.x,x.y,x.w,x.h),context.fillStyle="#fff",context.fillRect(x.x,x.y,x.w,x.h),n.drawInner(t,s,borderLoc,d,o)},10)},t.prototype.calcRedrawPath=function(t){for(var e=t[0],o=e.x,r=e.y,i=e.x,a=e.y,l=1;l<t.length;l++){var c=t[l];o=c.x<o?c.x:o,r=c.y<r?c.y:r,i=c.x>i?c.x:i,a=c.y>a?c.y:a}var f=n.width;return{x:o-f,y:r-f,w:i-o+2*f,h:a-r+2*f}},t.prototype.drawInner=function(t,e,o,i,l){this.drawLine({lines:o,style:n.color,width:n.width,fill:"#eaf2ff"}),this.drawLine({lines:e,style:a.border.color,width:a.border.width,fill:a.background});for(var c=0;c<o.length;c++)this.drawLine({lines:[{x:t[0],y:t[1]},o[c]],style:r.color})},t.prototype.drawIcon=function(t,e){var o=this;if(c.image){var n=new Image;n.src=c.image,n.onload=function(){for(var r=0;r<t.length;r++){var i=e[r].text,a=e[r].label,l=t[r],f=l.x+a.l,s=l.y+a.t;context.drawImage(n,a.sx,a.sy,2*a.w,2*a.h,context.ratio*f,context.ratio*s,context.ratio*a.w,context.ratio*a.h),o.dataLoc.push({x:f,y:s,w:a.w,h:a.h+20}),o.drawText({font:c.font,color:c.color,text:i,x:f+a.w/2,y:s+a.h+10})}}}else for(var r=0;r<t.length;r++){var i=e[r].text,a=e[r].label,l=t[r],f=l.x+a.l,s=l.y+a.t;o.dataLoc.push({x:f,y:s,w:context.measureText(i).width,h:10}),o.drawText({font:c.font,color:c.color,text:i,x:f,y:s})}},t.prototype.drawText=function(t){context.fillStyle=t.color,context.textAlign=t.align||"center",context.textBaseline=t.vertical||"middle",context.moveTo(t.x,t.y),context.font="12px sans-serif",context.fillText(t.text,t.x,t.y)},t.prototype.drawLine=function(t){var e=t.lines;context.beginPath(),context.moveTo(e[0].x,e[0].y);for(var o=1;o<e.length;o++)context.lineTo(e[o].x,e[o].y);context.closePath(),t.style&&(context.strokeStyle=t.style,context.lineWidth=t.width||1,context.stroke()),t.fill&&(context.fillStyle=t.fill,context.fill())},t});